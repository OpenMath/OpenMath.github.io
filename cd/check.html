<!DOCTYPE html>
<html>
 <head>
  <title>CD check</title>
  <meta charset="UTF-8"/>
  <style>
   .err {color: red}
   .indent{margin-left:2em;}
   .indent p {margin:0em;padding:0em;}
  </style>
  <script>

   // file drop

function dodrop(event) {
    var dt = event.dataTransfer;
    var files = dt.files;
    if(files.length == 1) {
	var fr = new FileReader();
	fr.onload = function(e) {
	    document.getElementById("cdin").textContent=e.target.result;
	};
	fr.readAsText(files[0]);
    } else {
        cdout.innerHTML = "only drop one file at a time";
    }      
}


// end of file drop code

// namespaces
var cdns="http://www.openmath.org/OpenMathCD";
var cdsns="http://www.openmath.org/OpenMathCDS";
var cdgns="http://www.openmath.org/OpenMathCDG";
var omns="http://www.openmath.org/OpenMath";

// regular expressions
   
// ascii version for now
var omNameRE= new RegExp(/^\s*[a-zA-Z][a-zA-Z0-9.\-_]*\s*$/);
var omURLRE= new RegExp(/^\s*[a-z]+:\/\/[^ ]*\s*$/);
var omDateRE= new RegExp(/^\s*[0-9]{4}-(0[1-9]|1[12])-(0[1-9]|[12][0-9]|3[01])\s*$/);


// code for the check button
function checkcd () {
    var cdout=document.getElementById("cdout");
    var sMyString = document.getElementById("cdin").textContent;
    var oParser = new DOMParser();

    var oDOM = oParser.parseFromString(sMyString, "text/xml");
    if (oDOM.getElementsByTagName("parsererror").length>0) {
	var x= oDOM.getElementsByTagName("parsererror")[0].textContent;
	cdout.innerHTML =
	    "<h3>XML Parse Error</h3><pre class='err'>\n" +
	    oDOM.getElementsByTagName("parsererror")[0].textContent.replace(/&/g,'&amp;').replace(/</g,'&lt;') +"</pre>";
    } else {
	cdout.innerHTML ="";
	vroot(oDOM);
    }
	if (document.getElementsByClassName!=undefined) {
            var errs=document.getElementsByClassName('err').length
	    var cdoutwrapper=document.getElementById("cdoutwrapper");
	    var errcount=document.getElementById("errcount");
	    if(errs==0) {
		cdoutwrapper.style.borderColor='green';
		cdoutwrapper.style.borderWidth='.2em';
		errcount.textContent='';
	    } else {
		cdoutwrapper.style.borderColor='red';
		cdoutwrapper.style.borderWidth='.2em';
		errcount.textContent=' (' +errs +' error' + (errs==1? '':'s') +' found)';
	    }
	}
}


// functions v* validate their input and place results in the output div
// functions vs* same but return a string
// some of the duplication here will be removed later, gradually moving to vs versions

function vroot (o) {
    var els=vChildren(o)
    if (els.length==1) {
	if (els[0].namespaceURI==cdns) {
	    if (els[0].localName=="CD") {
		vCD(els[0]);
	    } else {
		cdout.innerHTML = cdout.innerHTML + "<p class='err'>Bad root element: should be CD</p>";
	    }
	} else if (els[0].namespaceURI == cdsns) {
	    if (els[0].localName=="CDSignatures") {
		vCDSignatures(els[0]);
	    } else {
		cdout.innerHTML = cdout.innerHTML + "<p class='err'>Bad root element: should be CDSignatures</p>";
	    }
	} else if (els[0].namespaceURI==cdgns) {
	    if (els[0].localName=="CDGroup") {
		vCDGroup(els[0]);
	    } else {
		cdout.innerHTML = cdout.innerHTML + "<p class='err'>Bad root element: should be CDGroup</p>";
	    }
	} else if (els[0].namespaceURI == omns) {
	    if (els[0].localName=="OMOBJ") {
		vOMOBJ(els[0]);
	    } else {
		cdout.innerHTML = cdout.innerHTML + "<p class='err'>Bad root element: should be OMOBJ</p>";
	    }
	} else {
	    cdout.innerHTML = cdout.innerHTML + "<p class='err'>Bad root namespace:<br>" + els[0].namespaceURI + "<br>!=<br>" + cdns +" </p>";
	}
    } else {
	cdout.innerHTML = cdout.innerHTML + "<p class='err'`c>multiple root elements</p>";
    }
}

function vCDGroup(e) {
    err="";
    u="";
    err += vNoAttributes(e);
    vOut(err,"<b>OpenMath Content Dictionary Group File</b>");
    cdout.innerHTML = cdout.innerHTML + u;
    var els=vChildren(e);
    var CDGNamec=0;
    var CDGURLc=0;
    var CDGVersionc=0;
    var CDGRevisionc=0;
    for(var j=0;j<els.length;j++){
	var c=els[j];
	switch(c.localName) {
	case "CDGroupName":
	    vTextOne(c,++CDGNamec,omNameRE);
	    break;
	case "CDGroupDescription":
	    vDescription(c);
	    break;
	case "CDGroupVersion":
	    vTextOne(c,++CDGVersionc,/^\s*[0-9]+\s*$/);
	    break;
	case "CDGroupRevision":
	    vTextOne(c,++CDGRevisionc,/^\s*[0-9]+\s*$/);
	    break;
	case "CDGroupURL":
	    vTextOne(c,++CDGURLc,omURLRE);
	    break;
	case "CDComment":
	    vCDComment(c);
	    break;
	case "CDSStatus":
	    vTextOne(c,++CDSStatusc,/^\s*(official|experimental|private|obsolete)\s*$/);
	    break;
	case "CDGroupMember":
	    vCDGroupMember(c);
	    break;
	default:
	    vErr(c);
	}
    }
}


function vCDGroupMember (e) {
    cdout.innerHTML = cdout.innerHTML + "<p><b>CDGroupMember:</b></p>";
    var u= "<div class='indent'>";
    var els=vChildren(e);
    var j=0;
    if (els.length>j && els[j].localName=='CDComment') {
	u+=vsCDComment(els[j]);
	j++;
    }
    if (els.length>j && els[j].localName=='CDName') {
	u+=vsTextOne(els[j],1,omNameRE);
	j++;
    } else {
	vsErr(els[j]);
    }
    if (els.length>j && els[j].localName=='CDVersion') {
	u+=vsTextOne(els[j],1,/^\s*[0-9]+\s*$/);
	j++;
    }
    if (els.length>j && els[j].localName=='CDURL') {
	u+=vsTextOne(els[j],1,omURLRE);
	j++;
    }
    if (els.length>j) {
	u+=vsErr(els[j]);
    }
    u+="</div>";
    cdout.innerHTML = cdout.innerHTML + u;
}

function vCDSignatures(e) {
    err="";
    u="";
    var atts=e.attributes;
    for(var j=0;j<atts.length;j++){
	if(atts[j].localName=="type" || atts[j].localName=="cd"){
	    u+="<p><b>" + atts[j].localName +":</b> " + atts[j].value;
	} else if (atts[j].localName!="xmlns") {
	    err += " (Unexpected attribute: " + atts[j].localName +")";
	}
    }
    vOut(err,"<b>OpenMath Content Dictionary Signature File</b>");
    cdout.innerHTML = cdout.innerHTML + u;
    var els=vChildren(e);
    var CDSStatusc=0;
    var CDSRDatec=0;
    var CDSRevisionc=0;
    for(var j=0;j<els.length;j++){
	var c=els[j];
	switch(c.localName) {
	case "CDSComment":
	    vCDSComment(c);
	    break;
	case "CDSStatus":
	    vTextOne(c,++CDSStatusc,/^\s*(official|experimental|private|obsolete)\s*$/);
	    break;
	case "CDSReviewDate":
	    vTextOne(c,++CDSRDatec,omDateRE);
	    break;
	case "Signature":
	    vSignature(c);
	    break;
	default:
	    vErr(c);
	}
    }
}

function vCD(e) {
    cdout.innerHTML = cdout.innerHTML + "<p><b>OpenMath Content Dictionary</b></p>";
    var els=vChildren(e);
    var CDNamec=0;
    var CDURLc=0;
    var CDBasec=0;
    var CDRDatec=0;
    var CDDatec=0;
    var CDStatusc=0;
    var CDVersionc=0;
    var CDRevisionc=0;
    for(var j=0;j<els.length;j++){
	var c=els[j];
	switch(c.localName) {
	case "CDComment":
	    vCDComment(c);
	    break;
	case "Description":
	    vDescription(c);
	    break;
	case "CDName":
	    vTextOne(c,++CDNamec,omNameRE);
	    break;
	case "CDURL":
	    vTextOne(c,++CDURLc,omURLRE);
	    break;
	case "CDBase":
	    vTextOne(c,++CDBasec,omURLRE);
	    break;
	case "CDReviewDate":
	    vTextOne(c,++CDRDatec,omDateRE);
	    break;
	case "CDDate":
	    vTextOne(c,++CDDatec,omDateRE);
	    break;
	case "CDStatus":
	    vTextOne(c,++CDStatusc,/^\s*(official|experimental|private|obsolete)\s*$/);
	    break;
	case "CDUses":
	    vCDuses(c);
	    break;
	case "CDVersion":
	    vTextOne(c,++CDVersionc,/^\s*[0-9]+\s*$/);
	    break;
	case "CDRevision":
	    vTextOne(c,++CDRevisionc,/^\s*[0-9]+\s*$/);
	    break;
	case "CDDefinition":
	    vCDDefinition(c);
	    break;
	default:
	    vErr(c);
	}
    }
}



function vChildren(n) {
    var c=[];
    for(var j=0;j<n.childNodes.length; j++ ) {
	if(n.childNodes[j].nodeType==1) {
	    c[c.length]=n.childNodes[j];
	}
    }
    return c;
}

function vErr(c) {
    vOut("(Unexpected element: " +c.localName + ")","");
}

function vsErr(c) {
    return vsOut("(Unexpected element: " +c.localName + ")","");
}

function vTextOnly(e) {
    var c=vChildren(e);
    return (c.length==0 ? "" : " (Unexpected element: " + c[0].localName + ")");
}

function vNoAttributes(e) {
    var atts = e.attributes;
    err="";
    for (var j=0;j<atts.length;j++){
	if(atts[j].localName!='xmlns') err += " (Unexpected attribute: " + atts[j].localName + ")";
    }
    return err;
}

function vOut(err,t){
    cdout.innerHTML = cdout.innerHTML +
	"<p" + (err=="" ? "": " class='err'") +">" + t + err + "</p>";
}

function vsOut(err,t){
    return ("<p" + (err=="" ? "": " class='err'") +">" + t + err + "</p>");
}

function vsSpanOut(err,t){
    return ("<span" + (err=="" ? "": " class='err'") +">" + t + err + "</span>");
}

function vTestRE(e,r) {
    return (e.textContent.match(r) ? "" : " (Invalid text)");
}

function vCDComment (e) {
    var err="";
    err += vTextOnly(e);
    vOut(err,"<b>CDComment:</b>");
    if(err=="") {
	cdout.innerHTML = cdout.innerHTML +"<pre>" +e.textContent +"</pre>";
    }
}

function vsCDComment (e) {
    var err="";
    err += vTextOnly(e);
    var u = vsOut(err,"<b>CDComment:</b>");
    if(err=="") u+= "<pre>" +e.textContent +"</pre>";
    return u;
}

function vCDSComment (e) {
    var err="";
    err += vTextOnly(e);
    vOut(err,"<b>CDSComment:</b>");
    if(err==""){
	cdout.innerHTML = cdout.innerHTML +"<pre>" +e.textContent +"</pre>";
    }
}

function vDescription (e) {
    cdout.innerHTML = cdout.innerHTML + "<p><b>Description:</b><p><div> " +e.innerHTML + "</div>";
}

function vTextOne(e,ct,re) {
    var err="";
    err += vTextOnly(e);
    err += vNoAttributes(e);
    if (ct != 1) err += "(multiple " + e.localName +")";
    err += vTestRE(e,re);
    vOut(err,"<b>" + e.localName + ":</b> " +e.textContent);
}

function vsTextOne(e,ct,re) {
    var err="";
    err += vTextOnly(e);
    if (ct != 1) err += "(multiple " + e.localName +")";
    err += vTestRE(e,re);
    return vsOut(err,"<b>" + e.localName + ":</b> " +e.textContent);
}


function vCDuses (e) {
    cdout.innerHTML = cdout.innerHTML + "<p><b>CDUses:</b></p>";
    var u= "<div class='indent'>";
    var els=vChildren(e);
    for(var j=0;j<els.length;j++){
	var c=els[j];
	if (c.localName=='CDName') {
	    u+=vsTextOne(c,1,omNameRE);
	} else {
	    u+=vsErr(c);
	}
    }
    u+="</div>";
    cdout.innerHTML = cdout.innerHTML + u;
}





function vExample (e) {
    var u="";
    var err="";
    err += vNoAttributes(e);
    u+=vsOut(err,"<b>Example:</b>");
    if(err==""){
	var els=e.childNodes;
	for(var j=0;j<els.length;j++){
	    var c=els[j];
	    if(c.nodeType==3) {
		u+=c.nodeValue;
	    } else if (c.nodeType==1) {
		u+=vsOMOBJ(c);
	    }
	}
    }
    cdout.innerHTML = cdout.innerHTML + u;
}


function vFMP (e) {
    var err="";
    var k="";
    var atts=e.attributes;
    for(var j=0;j<atts.length;j++){
	if(atts[j].localName="kind"){
	    k= " (" + atts[j].value +")";
	} else {
	    err += " (Unexpected attribute: " + atts[j].localName +")";
	}
    }
    vOut(err, "<b>FMP" + k +":</b>");
    if(err=="") {
	var u= "<div class='indent'>";
	var els=vChildren(e);
	if(els.length==0) {
	    u+="<p class='err'>Missing element: OMOBJ</p>";
	} else if (els.length==1) {
	    u+=vsOMOBJ(els[0]);
	} else {
	    u+=vsErr(els[1]);
	}
	u+="</div>";
	cdout.innerHTML = cdout.innerHTML + u;
    }
}

function vSignature (e) {
    var err="";
    var k="";
    var atts=e.attributes;
    for(var j=0;j<atts.length;j++){
	if(atts[j].localName="name"){
	    k= " (" + atts[j].value +")";
	    err+=atts[j].value.match(omNameRE)?"":" (Invalid name)";
	} else {
	    err += " (Unexpected attribute: " + atts[j].localName +")";
	}
    }
    vOut(err, "<b>Signature" + k +":</b>");
    if(err=="") {
	var u= "<div class='indent'>";
	var els=vChildren(e);
	if(els.length==0) {
	    u+="<p class='err'>Missing element: OMOBJ</p>";
	} else if (els.length==1) {
	    u+=vsOMOBJ(els[0]);
	} else {
	    u+=vsErr(els[1]);
	}
	u+="</div>";
	cdout.innerHTML = cdout.innerHTML + u;
    }
}


function vCDDefinition (e) {
    var err="";
    err += vNoAttributes(e);
    vOut(err,"<b>CDDefinition:</b>");
    if(err==""){
	var Namec=0;
	var Rolec=0;
	var Descriptionc=0;
	var els=vChildren(e);
	for(var j=0;j<els.length;j++){
	    var c=els[j];
	    switch(c.localName) {
	    case "Name":
		vTextOne(c,++Namec,omNameRE);
		break;
	    case "Role":
		vTextOne(c,++Rolec,/^\s*(binder|attribution|semantic-attribution|error|application|constant)\s*$/);
		break;
	    case "CDComment":
		vCDComment(c);
		break;
	    case "Description":
		vTextOne(c,++Descriptionc,/./);
		break;
	    case "Example":
		vExample(c);
		break;
	    case "FMP":
		vFMP(c);
		break;
	    case "CMP":
		vTextOne(c,1,/./);
		break;
	    default:
		vErr(c);
	    }
	}
    }
}

function vOMOBJ(e) {
    var err="";
    var atts=e.attributes;
    for(var j=0;j<atts.length;j++) {
	switch(atts[j].localName) {
	case "id":
	case "version":
	case "cdbase":
	case "xmlns":
	    break;
	default:
	    err+=" (Unexpected attribute: " + atts[j].localName +")";
	}
    }
    vOut(err,"<b>OpenMath Object</b>");
    var els=vChildren(e);
    if (els.length = 1) {
	cdout.innerHTML = cdout.innerHTML + "<div>"+ vsOMel(els[0])+ "</div>";
    } else if (els.length=0) {
	vOut("(Empty OMOBJ)","");
    } else {
	vOut(" (Unexpected element)", els[1].localName);
    }
}

function vsOMel (c) {
    var u="";
    switch(c.localName) {
    case "OMS":
	u=vsOMS(c);
	break;
    case "OMV":
	u=vsOMV(c);
	break;
    case "OMI":
	u=vsOMI(c);
	break;
    case "OMB":
	u=vsOMB(c);
	break;
    case "OMSTR":
	u=vsOMSTR(c);
	break;
    case "OMF":
	u=vsOMF(c);
	break;
    case "OMA":
	u=vsOMA(c);
	break;
    case "OMBIND":
	u=vsOMBIND(c);
	break;
    case "OME":
	u=vsOME(c);
	break;
    case "OMATTR":
	u=vsOMATTR(c);
	break;
    case "OMR":
	u=vsOMR(c);
	break;
    default:
	u=vsErr(c);
    }
    return u;
}

function vsOMA(e) {
    var u="";
    var err="";
    var atts=e.attributes;
    for(var j=0;j<atts.length;j++) {
	switch(atts[j].localName) {
	case "id":
	case "cdbase":
	    break;
	default:
	    err+=" (Unexpected attribute: " + atts[j].localName +")";
	}
    }
    var els=vChildren(e);
    for(var j=0;j<els.length;j++){
	var c = els[j];
	u+=vsOMel(c);
	if(j==0){
	    u+= "(";
	} else if (j<els.length -1) {
	    u+=", ";
	}
    }
    u+=")";
    return vsSpanOut(err,u);
}

function vsOMSTR(e) {
    return '<tt>"' + vsTextOne(e,1,/./)+ '"</tt>';
}

function vsOMI(e) {
    return vsTextOne(e,1,/^[0-9 \t\r\n]*$/);
}

function vsOMB(e) {
    return vsTextOne(e,1,/./);
}
function vsOMV(e) {
    var err="";
    var v="";
    var atts=e.attributes;
    if(atts.length!=1 || atts[0].localName != "name") {
	err =" (Invalid OMV attributes)";
    } else {
	v=atts[0].value;
	err+=(v.match(omNameRE)?"":" (Invalid name)");
    }
    return "<i>" + vsSpanOut(err,v) + "</i>";
}

function vsOMF(e) {
    var err="";
    var d="";
    var h="";
    var atts=e.attributes;
    for(var j=0;j<atts.length;j++) {
	switch(atts[j].localName) {
	case "id":
	    break;
	case "dec":
	    if(h=="") {
		d=atts[j].value;
		err+=(d.match(/^[0-9.\-]+$/)?"":" (Invalid number)");
	    } else {
		err+="(unexpected dec attribute)";
	    }
	    break;
	case "hex":
	    if(h=="") {
		h=atts[j].value;
		err+=(h.match(/^[0-9A-F]+$/)?"":" (Invalid number)");
	    } else {
		err+="(unexpected hex attribute)";
	    }
	    break;
	default:
	    err+=" (Unexpected attribute: " + atts[j].localName +")";
	}
    }
    if (e.childNodes.length != 0) {
	err += " (Unexpected content in OMF)";
    }
    return vsSpanOut(err,h+d);
}


function vsOMS(e) {
    var err="";
    var n="";
    var cd="";
    var nc=0;
    var cdc=0;
    var atts=e.attributes;
    for(var j=0;j<atts.length;j++) {
	switch(atts[j].localName) {
	case "id":
	case "cdbase":
	    break;
	case "name":
	    nc++;
	    n=atts[j].value;
	    err+=(n.match(omNameRE)?"":" (Invalid name)");
	    break;
	case "cd":
	    cdc++;
	    cd=atts[j].value;
	    err+=(cd.match(omNameRE)?"":" (Invalid name)");
	    break;
	default:
	    err+=" (Unexpected attribute: " + atts[j].localName +")";
	}
    }
    if (e.childNodes.length != 0) {
	err += " (Unexpected content in OMS)";
    }
    if (nc==0) err += " (Missing attribute: name)";
    if (cdc==0) err += " (Missing attribute: cd)";
    if(err=="") {
	return ("<a href='../cd/" + cd +"'>" + n + "</a>");
    } else {
	return vsSpanOut(err,n);
    }
}

function vsOMBIND(e) {
    var err="";
    var u="";
    var cd="";
    var atts=e.attributes;
    for(var j=0;j<atts.length;j++) {
	switch(atts[j].localName) {
	case "id":
	case "cdbase":
	    break;
	default:
	    err+=" (Unexpected attribute: " + atts[j].localName +")";
	}
    }
    var els=vChildren(e);
    if(els.length==3) {
	u +="(";
	u+=vsOMel(els[0]);
	u+="[";
	u+=vsOMBVAR(els[1]);
	u+="] . ";
	u+=vsOMel(els[2]);
	u+=")";
    } else {
	err += "(OMBIND should have 3 children)";
    }
    return vsSpanOut(err,u);
}


function vsOME(e) {
    var err="";
    var atts=e.attributes;
    for(var j=0;j<atts.length;j++) {
	switch(atts[j].localName) {
	case "id":
	    break;
	default:
	    err+=" (Unexpected attribute: " + atts[j].localName +")";
	}
    }
    var els=vChildren(e);
    var u = "<span class='ome'>Error( ";
    if (els.length != 0||els[0].localName=="OMS") {
	err += "(Missing OMS)";
    } else {
        u+=vsOMS(els[0]);
    }
    for(var j = 1; j<els.length;j++) {
	u+= (j==1? ": " : ", ");
	u+=vsOMel(els[j]);
    }
    u +=")</span>";
    return vsSpanOut(err,u);
}

function vsOMOBJ(e) {
    var err="";
    var u="";
    if (e.localName=='OMOBJ' && e.namespaceURI==omns) {
	var atts=e.attributes;
	for(var j=0;j<atts.length;j++) {
	    switch(atts[j].localName) {
	    case "id":
	    case "version":
	    case "cdbase":
	    case "xmlns":
		break;
	    default:
		err+=" (Unexpected attribute: " + atts[j].localName +")";
	    }
	}
	var els=vChildren(e);
	if (els.length = 1) {
	    u+=vsOMel(els[0]);
	} else if (els.length=0) {
	    err="(empty OMOBJ)";
	} else {
	    err="(Unexpected children in OMOBJ)";
	}
    } else {
	err="(Unexpected element {" + e.namespaceURI + "}" + e.localName + ")";
    }
    return vsSpanOut(err,u);
}

function vsOMATTR(e) {
    return "OMATTR";
}


function vsOMBVAR(e) {
    var err="";
    var u = "";
    var atts=e.attributes;
    for(var j=0;j<atts.length;j++) {
	switch(atts[j].localName) {
	case "id":
	    break;
	default:
	    err+=" (Unexpected attribute: " + atts[j].localName +")";
	}
    }
    var els=vChildren(e);
    for(var j = 0; j<els.length;j++) {
	u+= (j>0? ", " : "");
	if(els[j].localName!="OMV" && els[j].localName!="OMV") err+="(Unexpected element)";
	u+=vsOMel(els[j]);
    }
    return vsSpanOut(err,u);
}


function vsOMR(e) {
    var err="";
    var h="";
    var atts=e.attributes;
    for(var j=0;j<atts.length;j++) {
	switch(atts[j].localName) {
	case "id":
	    break;
	case "href":
	    h=atts[j].value;
	    err+=(cd.match(omURLRE)?"":" (URL)");
	    break;
	default:
	    err+=" (Unexpected attribute: " + atts[j].localName +")";
	}
    }
    if (e.childNodes.length != 0) {
	err += " (Unexpected content in OMR)";
    }
    if(err=="") {
	return ("<a href='" + h +"'>ref</a>");
    } else {
	return vsSpanOut(err,n);
    }
}

function sampleom() {
document.getElementById("cdin").textContent='\n\
<OMOBJ xmlns="http://www.openmath.org/OpenMath" verrsion="2.0" cdbase="http://www.openmath.org/cd">\n\
  <OMA>\n\
    <OMS cd="relation1" name="="/>\n\
    <OMA>\n\
      <OMA>\n\
        <OMS cd="calculus1" name="diff"/>\n\
        <OMBIND>\n\
          <OMS cd="fns1" name="lambda"/>\n\
          <OMBVAR>\n\
            <OMV name="y"/>\n\
          </OMBVAR>\n\
          <OMA style="bad">\n\
            <OMS cd="arith1" name="plus"/>\n\
            <OMA>\n\
              <OMV name="a"/>\n\
              <OMV name="y"/>\n\
            </OMA>\n\
            <OMA>\n\
              <OMV name="b"/>\n\
              <OMV name="y"/>\n\
            </OMA>\n\
          </OMA>\n\
        </OMBIND>\n\
      </OMA>\n\
      <OMV name="x"/>\n\
    </OMA>\n\
    <OMA>\n\
      <OMS cd="arith1" name="plus"/>\n\
      <OMA>\n\
        <OMA>\n\
          <OMS cd="calculus1" name="diff"/>\n\
          <OMBIND>\n\
            <OMS cd="fns1" name="lambda"/>\n\
            <OMBVAR>\n\
              <OMV name="y"/>\n\
            </OMBVAR>\n\
            <OMA>\n\
              <OMV name="a"/>\n\
              <OMV name="y"/>\n\
            </OMA>\n\
          </OMBIND>\n\
        </OMA>\n\
        <OMV name="x"/>\n\
      </OMA>\n\
      <OMA>\n\
        <OMA>\n\
          <OMS cd="calculus1" name="diff"/>\n\
          <OMBIND>\n\
            <OMS cd="fns1" name="lambda"/>\n\
            <OMBVAR>\n\
              <OMV name="y"/>\n\
            </OMBVAR>\n\
            <OMA>\n\
              <OMV name="b"/>\n\
              <OMV name="y"/>\n\
            </OMA>\n\
          </OMBIND>\n\
        </OMA>\n\
        <OMV name="x"/>\n\
      </OMA>\n\
    </OMA>\n\
  </OMA>\n\
</OMOBJ>\n\
';
}

function samplecdg() {
document.getElementById("cdin").textContent='\n\
<CDGroup  xmlns="http://www.openmath.org/OpenMathCDG">\n\
<CDGroupName>mathml-x</CDGroupName>\n\
<CDGroupVersion> 2.1 </CDGroupVersion>\n\
<CDGroupRevision> b </CDGroupRevision>\n\
<CDGroupURL>http://www.openmath.org/cdfiles/cdgroups/mathml.ocd</CDGroupURL>\n\
<CDGroupDescription> MathML compatibility CD Group </CDGroupDescription>\n\
<CDComment>This is an abbreviated  MathML CD group.</CDComment>\n\
<CDComment>Algebra</CDComment>\n\
<CDGroupMember>\n\
<CDName>alg1</CDName>\n\
<CDURL>www.openmath.org/cd/alg1.ocd</CDURL></CDGroupMember>\n\
<CDComment>Arithmetic</CDComment>\n\
<CDGroupMember>\n\
<CDName>arith1</CDName>\n\
<CDURL>http://www.openmath.org/cd/arith1.ocd</CDURL></CDGroupMember>\n\
<CDComment>Constructor for Floating Point Numbers</CDComment>\n\
<CDGroupMember>\n\
<CDName>bigfloat1</CDName>\n\
<CDURL>http://www.openmath.org/cd/bigfloat1.ocd</CDURL></CDGroupMember>\n\
<Example>example here</Example>\n\
<CDComment>Calculus</CDComment>\n\
<CDGroupMember>\n\
<CDName>calculus1</CDName>\n\
<CDURL>http://www.openmath.org/cd/calculus1.ocd</CDURL></CDGroupMember>\n\
<CDComment>Linear Algebra - vector &amp; matrix constructors, those symbols which are dependant of orientation, and in MathML</CDComment>\n\
<CDGroupMember>\n\
<CDName>linalg2</CDName>\n\
<CDURL>http://www.openmath.org/cd/linalg2.ocd</CDURL></CDGroupMember>\n\
<CDComment>Limits of <i>unary</i> functions</CDComment>\n\
<CDGroupMember>\n\
<CDName>limit1</CDName>\n\
<CDURL>http://www.openmath.org/cd/limit1.ocd</CDURL></CDGroupMember>\n\
<CDComment>List constructors</CDComment>\n\
<CDGroupMember>\n\
<CDName>mathmltypes</CDName>\n\
<CDURL>http://www.openmath.org/cd/mathmltypes.ocd</CDURL>\n\
</CDGroupMember>\n\
<CDComment>Minima and maxima</CDComment>\n\
<CDGroupMember>\n\
<CDName>minmax1</CDName>\n\
<CDURL>http://www.openmath.org/cd/minmax1.ocd</CDURL></CDGroupMember>\n\
<CDComment>Multset-theoretic operators and constructors</CDComment>\n\
<CDGroupMember>\n\
<CDName>multiset1</CDName>\n\
<CDURL>http://www.openmath.org/cd/multiset1.ocd</CDURL></CDGroupMember>\n\
<CDComment>Symbols for creating numbers, including some defined constants\n\
(which can be seen as nullary constructors)</CDComment>\n\
<CDGroupMember>\n\
<CDName>nums1</CDName>\n\
<CDURL>http://www.openmath.org/cd/nums1.ocd</CDURL></CDGroupMember>\n\
<CDComment>Symbols for creating piecewise definitions</CDComment>\n\
<CDGroupMember>\n\
<CDName>piece1</CDName>\n\
<CDURL>http://www.openmath.org/cd/piece1.ocd</CDURL></CDGroupMember>\n\
<CDComment>The basic quantifiers forall and exists.</CDComment>\n\
<CDGroupMember>\n\
<CDName>quant1</CDName>\n\
<CDURL>http://www.openmath.org/cd/quant1.ocd</CDURL></CDGroupMember>\n\
<CDComment>Common arithmetic relations</CDComment>\n\
<CDGroupMember>\n\
<CDName>relation1</CDName>\n\
<CDURL>http://www.openmath.org/cd/relation1.ocd</CDURL></CDGroupMember>\n\
<CDComment>Number sets</CDComment>\n\
<CDGroupMember>\n\
<CDName>setname1</CDName>\n\
<CDURL>http://www.openmath.org/cd/setname1.ocd</CDURL></CDGroupMember>\n\
</CDGroup>\n\
';
}

function samplests() {
document.getElementById("cdin").textContent='\n\
<CDSignatures xmlns="http://www.openmath.org/OpenMathCDS" type="sts" cd="set1">\n\
<CDSStatus> fake </CDSStatus>\n\
\n\
<CDSComment>\n\
Based on Set1 STS file\n\
</CDSComment>\n\
\n\
<Signature name="cartesian_product">\n\
<OMOBJ xmlns="http://www.openmath.org/OpenMath"> \n\
  <OMA>\n\
    <OMS cd="sts" name="mapsto"/>\n\
    <OMA>\n\
      <OMS name="nary"/>\n\
      <OMA>\n\
        <OMS cd="sts" name="structure"/>\n\
	<OMV name="Set"/>\n\
      </OMA>\n\
    </OMA>\n\
    <OMA>\n\
      <OMS cd="sts" name="structure"/>\n\
      <OMV name="Set1"/>\n\
    </OMA>\n\
  </OMA>\n\
</OMOBJ>\n\
</Signature>\n\
\n\
<Signature name="map">\n\
<OMOBJ xmlns="http://www.openmath.org/OpenMath"> \n\
 <OMA>\n\
  <OMS cd="sts" name="mapsto"/>\n\
    <OMA>\n\
      <OMS cd="sts" name="mapsto"/>\n\
      <OMS cd="sts" name="Object"/>\n\
      <OMS cd="sts" name="Object"/>\n\
    </OMA>\n\
    <OMV name="Set"/>\n\
    <OMV name="Set"/>\n\
 </OMA>\n\
</OMOBJ>\n\
<CDComment>???</CDComment>\n\
</Signature>\n\
\n\
<Signature name="such that">\n\
<OMOBJ xmlns="http://www.openmath.org/OpenMath"> \n\
 <OMA>\n\
  <OMS cd="sts" name="mapsto"/>\n\
    <OMA>\n\
      <OMS name="structure" cd="sts"/>\n\
      <OMV name="Set"/>\n\
    </OMA>\n\
    <OMA>\n\
      <OMS name="mapsto" cd="sts"/>\n\
      <OMV name="Set"/>\n\
      <OMS name="Boolean" cd="setname2"/>\n\
    </OMA>\n\
    <OMA>\n\
      <OMS name="structure" cd="sts"/>\n\
      <OMV name="Set"/>\n\
    </OMA>\n\
 </OMA>\n\
</OMOBJ>\n\
</Signature>\n\
\n\
<Signature name="emptyset" >\n\
 <OMOBJ xmlns="http://www.openmath.org/OpenMath"> \n\
   <OMV name="Set"/>\n\
 </OMOBJ>\n\
</Signature>\n\
\n\
<Signature name="size" >\n\
<OMOBJ xmlns="http://www.openmath.org/OpenMath"> \n\
 <OMA>\n\
   <OMS name="mapsto" cd="sts" />\n\
    <OMV name="Set" />\n\
    <OMV name="CardinalNumber" />\n\
 </OMA>\n\
</OMOBJ>\n\
</Signature>\n\
\n\
<Signature name="set" >\n\
<OMOBJ xmlns="http://www.openmath.org/OpenMath"> \n\
 <OMA>\n\
  <OMS name="mapsto" cd="sts" />\n\
   <OMA>\n\
    <OMS name="nary" cd="sts" />\n\
     <OMS name="Object" cd="sts" />\n\
   </OMA>\n\
  <OMV name="Set" />\n\
 </OMA>\n\
</OMOBJ>\n\
</Signature>\n\
\n\
<Signature name="intersect" >\n\
<OMOBJ xmlns="http://www.openmath.org/OpenMath"> \n\
 <OMA>\n\
   <OMS name="mapsto" cd="sts" />\n\
    <OMA>\n\
     <OMS name="nassoc" cd="sts" />\n\
     <OMV name="Set" />\n\
    </OMA>\n\
    <OMV name="Set" />\n\
 </OMA>\n\
</OMOBJ>\n\
</Signature>\n\
\n\
<Signature name="union" >\n\
<OMOBJ xmlns="http://www.openmath.org/OpenMath"> \n\
 <OMA>\n\
   <OMS name="mapsto" cd="sts" />\n\
    <OMA>\n\
     <OMS name="nassoc" cd="sts" />\n\
     <OMV name="Set" />\n\
    </OMA>\n\
    <OMV name="Set" />\n\
 </OMA>\n\
</OMOBJ>\n\
</Signature>\n\
\n\
<Signature name="setdiff" >\n\
<OMOBJ xmlns="http://www.openmath.org/OpenMath"> \n\
 <OMA>\n\
   <OMS name="mapsto" cd="sts" />\n\
    <OMV name="Set" />\n\
    <OMV name="Set" />\n\
    <OMV name="Set" />\n\
 </OMA>\n\
</OMOBJ>\n\
</Signature>\n\
\n\
\n\
<Signature name="subset" >\n\
<OMOBJ xmlns="http://www.openmath.org/OpenMath"> \n\
 <OMA>\n\
   <OMS name="mapsto" cd="sts" />\n\
    <OMV name="Set" />\n\
    <OMV name="Set" />\n\
    <OMS cd="setname2" name="Boolean" />\n\
 </OMA>\n\
</OMOBJ>\n\
</Signature>\n\
\n\
\n\
<Signature name="in" >\n\
<OMOBJ xmlns="http://www.openmath.org/OpenMath"> \n\
 <OMA>\n\
   <OMS name="mapsto" cd="sts" />\n\
    <OMS name="Object" cd="sts" />\n\
    <OMV name="Set" />\n\
    <OMS cd="setname2" name="Boolean" />\n\
 </OMA>\n\
</OMOBJ>\n\
</Signature>\n\
\n\
<Signature name="notin" >\n\
<OMOBJ xmlns="http://www.openmath.org/OpenMath"> \n\
 <OMA>\n\
   <OMS name="mapsto" cd="sts" />\n\
    <OMS name="Object" cd="sts" />\n\
    <OMV name="Set" />\n\
    <OMS cd="setname2" name="Boolean" />\n\
 </OMA>\n\
</OMOBJ>\n\
</Signature>\n\
\n\
\n\
<Signature name="prsubset" >\n\
<OMOBJ xmlns="http://www.openmath.org/OpenMath"> \n\
 <OMA>\n\
   <OMS name="mapsto" cd="sts" />\n\
    <OMV name="Set" />\n\
    <OMV name="Set" />\n\
    <OMS cd="setname2" name="Boolean" />\n\
 </OMA>\n\
</OMOBJ>\n\
</Signature>\n\
\n\
<Signature name="notsubset" >\n\
<OMOBJ xmlns="http://www.openmath.org/OpenMath"> \n\
 <OMA>\n\
   <OMS name="mapsto" cd="sts" />\n\
    <OMV name="Set" />\n\
    <OMV name="Set" />\n\
    <OMS cd="setname2" name="Boolean" />\n\
 </OMA>\n\
</OMOBJ>\n\
</Signature>\n\
\n\
<Signature name="notprsubset" >\n\
<OMOBJ xmlns="http://www.openmath.org/OpenMath"> \n\
 <OMA>\n\
   <OMS name="mapsto" cd="sts" />\n\
    <OMV name="Set" />\n\
    <OMV name="Set" />\n\
    <OMS cd="setname2" name="Boolean" />\n\
 </OMA>\n\
</OMOBJ>\n\
</Signature>\n\
\n\
</CDSignatures>\n\
';
}


function samplecd() {
document.getElementById("cdin").textContent='\n\
<CD xmlns="http://www.openmath.org/OpenMathCD">\n\
<CDName> arith1 </CDName>\n\
<CDName> arith11 </CDName>\n\
<CDName> 7 + arith </CDName>\n\
<CDDate> Jan 1, 2000 </CDDate>\n\
<CDReviewDate> 2017-12-25</CDReviewDate>\n\
<CDStatus a="b"> experimental</CDStatus>\n\
<CDComment> Some <b>bold text</b></CDComment>\n\
<CDBase>http://www.openmath.org/cd</CDBase>\n\
<CDURL> htt p://www.openmath.org/cd/arith1.ocd </CDURL>\n\
<CDVersion>99</CDVersion>\n\
<CDRevision> 2b </CDRevision>\n\
<wibble>hmm</wibble>\n\
<CDUses>\n\
  <CDName>set1</CDName>\n\
  <CDName>sat1</CDName>\n\
  <DCName>set2</DCName>\n\
</CDUses>\n\
<CDDefinition>\n\
<Name> lcm </Name>\n\
<Role>application</Role>\n\
<Example>text <OMOBJ> <OMV name="a"/></OMOBJ> more text</Example>\n\
<Example>text <OMOBJ xmlns="http://www.openmath.org/OpenMath"> <OMV name="a"/></OMOBJ> more text</Example>\n\
<Description> \n\
The symbol to represent the n-ary function to return the least common\n\
multiple of its arguments.\n\
</Description>\n\
\n\
<CMP> lcm(a,b) = a*b/gcd(a,b) </CMP>\n\
\n\
<FMP>\n\
<OMOBJ xmlns="http://www.openmath.org/OpenMath" version="2.0" cdbase="http://www.openmath.org/cd">\n\
  <OMA>\n\
    <OMS cd="relation1" name="eq"/>\n\
    <OMA>\n\
      <OMS cd="arith1" name="lcm"/>\n\
      <OMV name="a"/>\n\
      <OMV name="b"/>\n\
    </OMA>\n\
    <OMA>\n\
      <OMS cd="arith1" name="divide"/>\n\
      <OMA>\n\
        <OMS cd="arith1" name="times"/>\n\
	<OMV name="a"/>\n\
	<OMV name="b"/>\n\
      </OMA>\n\
      <OMA>\n\
        <OMS cd="arith1" name="gcd"/>\n\
        <OMV name="a"/>\n\
        <OMV name="b"/>\n\
      </OMA>\n\
    </OMA>\n\
  </OMA>\n\
</OMOBJ>\n\
</FMP>\n\
</CDDefinition>\n\
</CD>\n\
';
}

</script>
 </head>
    <body>


<div>
 <div style="width:5em;float:left;margin-right:1em;">
    <a href="/">
    <img src="https://openmath.github.io/public/logo.png" alt="OpenMath" width="100%"/>
    </a>                
    </div>

  <h1>OpenMath XML Syntax Test Page</h1>
    <p>Edit the CD below or drag a new CD (or other OpenMath file)
on to the grey bar above the edit box.</p>
    <p>Other (invalid) examples may be inserted using the buttons below.</p>
   
    <p>
  <input type="button" onclick="samplecd()" value="sample CD"></input>
  <input type="button" onclick="samplecdg()" value="sample CDG"></input>
  <input type="button" onclick="sampleom()" value="sample OM"></input>
  <input type="button" onclick="samplests()" value="sample STS"></input>
    </p>

    <p>Use the <b>check</b> button to check the XML.</p>
    <p>OpenMath, CD, CDGroup and STS files are accepted.</p>

   <p><input style="font-size:110%; padding:.5em;" type="button" onclick="checkcd()" value="Check"></input></p>
  <div
      style="width:47%;display:inline-block;border: solid thin black;
	     padding:0.5em;
   vertical-align:top">
   <h2>Input</h2>

   <div id="filedrop" style="background-color:#DDD; white-space: pre; margin-bottom:.5em; padding:1em;border: 1px solid black;"
      event.stopPropagation(); event.preventDefault();"
     ondragover="event.stopPropagation(); event.preventDefault();"
     ondrop="event.stopPropagation(); event.preventDefault();
     dodrop(event);">Drop a file here from finder or explorer or edit the text below.</div>


   <div id="cdin" contenteditable=true
    style="overflow:auto;white-space:pre;">
</div>
</div>
<div id="cdoutwrapper"
    style="width:47%;display:inline-block;border: solid black thin; background-color:#EEE;
padding:0.5em; min-height:50em;
	   overflow:auto;vertical-align:top">
 <h2>Output <span id="errcount"></span></h2>
 <div id="cdout">
 </div>
</div>
<script>
samplecd();
</script>
 </body>
</html>
